<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gogi.meatyou.repository.CustomersMapper">

		<insert id="productUp" parameterType="com.gogi.meatyou.bean.ProductDTO">
	    	insert into product(p_num, p_m_id, p_name, p_category, p_s_category, thumb, p_price, p_rcount, p_reg_date, startdate, enddate, p_status) values (
	    	product_seq.NEXTVAL,
	    	#{p_m_id},
	    	#{p_name},
	    	#{p_category},
	    	#{p_s_category},
	    	#{thumb},
	    	#{p_price},
	    	0,	    	
	    	sysdate,
	    	to_date(#{startdate},'YYYY-MM-DD'),
	    	to_date(#{enddate},'YYYY-MM-DD'),    
	    	0)
	    </insert>

		<insert id="P_DETAILUp" parameterType="com.gogi.meatyou.bean.PDetailDTO">
	    	insert into P_DETAIL(pd_p_num, pd_p_desc, origin, local, weight, butchery, serialNum, retain, stock, pd_duedate, pd_p_status) values (
	    	P_DETAIL_seq.NEXTVAL,
	    	#{pd_p_desc},	    	
	    	#{origin},
	    	#{local},
	    	#{weight},	    	
	    	#{butchery},
	    	#{serialNum},
	    	#{retain},
	    	#{stock},
	    	#{pd_duedate},
	    	0)	    	
	    </insert>
		
		<select id="itemcount" resultType="int">
	    	select count(*) from product where p_m_id = #{id}
	    </select>
	    
		<select id="itemcounting" resultType="int">
	    	select count(*) from product where p_m_id = #{id} and p_status = 0 or p_status = 1
	    </select>
	    
	    <select id="itemcountout" resultType="int">
	    	select count(*) from product where p_m_id = #{id} and p_status = 2 or p_status = 3
	    </select>
	    
	    <select id="list" resultType="com.gogi.meatyou.bean.ProductDTO">
	    SELECT * FROM product WHERE p_M_ID = #{id} ORDER BY p_num DESC
	    </select>
	    
	 	<select id="listing" resultType="com.gogi.meatyou.bean.ProductDTO">
	    select * from product where p_M_ID = #{id} and p_status = 0 or p_status = 1 ORDER BY p_num DESC
	    </select>
	    
	    <select id="listout" resultType="com.gogi.meatyou.bean.ProductDTO">
	    select * from product where p_M_ID = #{id} and p_status = 2 or p_status = 3 ORDER BY p_num DESC
	    </select>
	    
	    <select id="member_status" resultType="int">
	    SELECT M_Status FROM member WHERE m_id = #{id}
	    </select>
	    
		<update id="statusChange" parameterType="com.gogi.meatyou.bean.ProductDTO">
    		UPDATE product SET p_status=#{p_status} WHERE p_M_ID=#{p_m_id} AND p_num=#{p_num}		
    	</update>
    	
    	
    	  <select id="lister" resultType="com.gogi.meatyou.bean.ProductDTO">
	    SELECT * FROM product JOIN P_DETAIL ON product.p_num = P_DETAIL.pd_p_num WHERE product.p_m_id = #{id}
	    </select>
    	
    	

</mapper>