<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gogi.meatyou.repository.BoardMapper">
 	
 	<select id="userQnacount" resultType="int">
 		select count(*) from P_QUESTION where (pq_status =  0 or pq_status = 3)
 	</select>
	
	<select id="userQnalist" resultType="com.gogi.meatyou.bean.PQuestionDTO" parameterType="hashmap">
	<![CDATA[
		SELECT * FROM ( SELECT b.*, rownum r FROM (select * from P_QUESTION where pq_p_num= #{pq_p_num} and (pq_status =  0 or pq_status = 3) order by pq_num desc ) b) WHERE r>=#{start} and r<=#{end}
	]]>
	</select>
	
	<select id="getuserQnacotent" resultType="com.gogi.meatyou.bean.PQuestionDTO">
		select * from P_QUESTION where pq_num = #{pq_num} and pq_p_num = #{pq_p_num}
	</select>
	
	<select id="getCuserContent" resultType="com.gogi.meatyou.bean.PQuestionDTO">
		select * from P_QUESTION where pq_p_num = #{pq_p_num} and pq_ref = #{pq_ref} and (pq_status = 1 or pq_status = 4)
	</select>
	
	<select id="getPidPnum" resultType="String" >
		select p.p_m_id from product p, P_QUESTION q where p.p_num = q.pq_p_num and q.pq_p_num = #{pq_p_num} and q.pq_ref = #{pq_ref} and (q.pq_status = 0 or q.pq_status = 3)
	</select>
	
	<select id="getAnswerCount" resultType="int">
		select count(*) from P_QUESTION where pq_p_num = #{pq_p_num} and pq_ref = #{pq_ref}
	</select>
	
	<insert id="wirteAnswerd" parameterType="com.gogi.meatyou.bean.PQuestionDTO">
		insert into P_QUESTION(pq_num, pq_m_id, pq_p_num, pq_title, pq_content, pq_status, pq_ref, pq_reg_date) values (
		P_QUESTION_seq.NEXTVAL,
		#{pq_m_id},
		#{pq_p_num},
		'판매자 답변',
		#{pq_content},
		#{pq_status},
		#{pq_ref},
		sysdate
		)
	</insert>
	
	
	<select id="getBoardNEXTNum" resultType="int">
         select P_QUESTION_seq.NEXTVAL from dual
      </select>
	
	 <insert id="userQnaUp" parameterType="com.gogi.meatyou.bean.PQuestionDTO">
          insert into P_QUESTION(pq_num, pq_m_id, pq_p_num, pq_title, pq_content, pq_status, pq_ref, pq_reg_date) values (
         	#{pq_num},
			#{pq_m_id},
			#{pq_p_num},
			#{pq_title},
			#{pq_content},
			#{pq_status},
			#{pq_num},
			sysdate 
          )
       </insert>
	
		<insert id="boardFileReg" parameterType="com.gogi.meatyou.bean.NoticeFileDTO">
         insert into NOTICEFILE values(
         NOTICEFILE_seq.nextval,
         #{nf_n_num},
         #{nf_filename},
         #{nf_category}
         )     
       </insert>
	
	
	
</mapper>